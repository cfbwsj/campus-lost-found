# 📖 校园失物招领系统 - 使用说明

## 🎯 发布信息完整流程

### ✅ 正确的发布流程

1. **访问发布页面**
   ```
   http://localhost:3000/upload
   ```

2. **选择发布类型**
   - 我丢失了物品（发布失物信息）
   - 我捡到了物品（发布招领信息）

3. **上传图片**
   - 拖拽或点击上传区域
   - 支持jpg/png/gif等格式
   - 单个文件最大10MB
   - 图片会自动上传到服务器

4. **填写物品信息**（所有字段都必填）
   - **物品名称**：如"黑色钱包"
   - **物品分类**：选择对应类别
   - **详细描述**：详细描述物品特征
   - **丢失/拾取地点**：具体位置
   - **丢失/拾取时间**：选择日期和时间
   - **联系方式**：您的手机号或邮箱

5. **点击"发布信息"按钮**
   - ✅ 成功后会跳转到对应列表页
   - ❌ 失败会显示错误信息

---

## 🔍 查看发布的信息

### 方法1：列表页查看
- **失物列表**: http://localhost:3000/lost
- **招领列表**: http://localhost:3000/found

### 方法2：首页统计
- 访问首页查看统计数字
- 统计数字会实时更新

### 方法3：搜索
- 使用搜索功能查找特定物品

---

## 📊 数据存储位置

| 类型 | 存储位置 |
|------|----------|
| **物品信息** | PostgreSQL数据库（`campus_db`） |
| **上传图片** | `backend/uploads/images/年/月/日/` |

### 查看数据库

**连接信息：**
```
Host: localhost
Port: 5432
Database: campus_db
User: postgres
Password: password
```

**查看失物记录：**
```sql
SELECT * FROM lost_items ORDER BY created_at DESC;
```

**查看招领记录：**
```sql
SELECT * FROM found_items ORDER BY created_at DESC;
```

---

## ❌ 常见问题

### Q1: 为什么上传了图片但数据库没有记录？

**A:** 只上传图片不会创建数据库记录，必须完成以下步骤：
1. ✅ 上传图片
2. ✅ 填写所有必填字段
3. ✅ 点击"发布信息"按钮 ← **这一步才会保存到数据库**

---

### Q2: 点击"发布信息"后没反应？

**可能原因：**
1. 表单验证未通过（检查是否所有必填项都已填写）
2. 后端服务未启动（访问 http://localhost:8000/docs 检查）
3. 数据库连接失败（查看Docker日志）

**检查方法：**
- 打开浏览器控制台（F12）查看错误信息
- 查看Docker日志：`docker-compose logs backend`

---

### Q3: 如何确认数据已保存？

**方法1：前端查看**
- 发布成功后会自动跳转到列表页
- 在列表页应该能看到刚发布的信息

**方法2：API查看**
- 访问 http://localhost:8000/docs
- 使用 `GET /api/items/lost` 或 `GET /api/items/found` 接口查询

**方法3：数据库查看**
- 使用DBeaver、pgAdmin等工具连接数据库
- 查询 `lost_items` 或 `found_items` 表

---

### Q4: 上传的图片存在哪里？

**存储路径：**
```
D:\AIweb\campus-lost-found\backend\uploads\images\2025\10\30\
                                                   年  月  日
```

**访问URL：**
```
http://localhost:8000/uploads/images/2025/10/30/文件名.jpg
```

---

## 🧪 测试数据流程

### 1. 测试完整发布流程

```
1. 访问 http://localhost:3000/upload
2. 选择"我丢失了物品"
3. 上传一张图片
4. 填写表单：
   - 物品名称：测试钱包
   - 分类：钱包证件
   - 描述：黑色皮质钱包
   - 地点：图书馆3楼
   - 时间：选择今天
   - 联系方式：13800138000
5. 点击"发布信息"
6. 应该跳转到失物列表，能看到刚发布的信息
```

### 2. 验证数据库记录

**打开浏览器访问：**
```
http://localhost:8000/docs
```

**调用接口：**
```
GET /api/items/lost
```

**应该返回：**
```json
{
  "items": [
    {
      "id": 1,
      "title": "测试钱包",
      "category": "钱包证件",
      "description": "黑色皮质钱包",
      "location": "图书馆3楼",
      "lost_date": "2025-10-30T12:00:00",
      "contact": "13800138000",
      "image_url": "http://localhost:8000/uploads/images/2025/10/30/xxx.jpg",
      "status": "pending",
      "created_at": "2025-10-30T12:34:56"
    }
  ],
  "total": 1,
  "skip": 0,
  "limit": 20
}
```

---

## 🔧 调试技巧

### 查看后端日志
```bash
docker-compose logs -f backend
```

### 查看数据库日志
```bash
docker-compose logs -f postgres
```

### 重启后端服务
```bash
docker-compose restart backend
```

### 清空数据库重新开始
```bash
# 停止所有服务
docker-compose down -v

# 重新启动
./启动Docker.bat
```

---

## 📝 数据表结构

### lost_items（失物表）

| 字段 | 类型 | 说明 |
|------|------|------|
| id | Integer | 主键 |
| title | String | 物品名称 |
| category | String | 分类 |
| description | Text | 描述 |
| image_url | String | 图片URL |
| location | String | 地点 |
| lost_date | DateTime | 丢失时间 |
| contact | String | 联系方式 |
| status | String | 状态（pending/matched/closed） |
| created_at | DateTime | 创建时间 |
| is_active | Boolean | 是否有效 |

### found_items（招领表）

结构与 `lost_items` 相同，只是 `lost_date` 字段表示"拾取时间"。

---

**祝使用愉快！** 🎉

